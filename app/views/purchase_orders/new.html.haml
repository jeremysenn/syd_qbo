= render partial: "shared/navbars/new_and_edit_purchase_order_navbar", locals: {title: "New ticket", total: number_to_currency(0)}

.container
  = form_tag purchase_orders_path, id: 'purchase_order_form', :class => "form-horizontal" do |f|
    #vendor_accordion.panel-group{"aria-multiselectable" => "true", :role => "tablist"}
      .panel.panel-default
        %div.panel-heading{:role => "tab", id: "vendor_heading"}
          %h4.panel-title
            %a{"aria-controls" => "collapseVendor", "aria-expanded" => "true", "data-parent" => "#vendor_accordion", "data-toggle" => "collapse", :href => "#collapseVendor", :role => "button"}
              Vendor
        #collapseVendor.panel-collapse.collapse.in{"aria-labelledby" => "headingOne", :role => "tabpanel"}
          .panel-body
            = select_tag "purchase_order[vendor]", options_for_select(Rails.cache.fetch("all_vendors"), params[:vendor_id]), prompt: "Choose a vendor", class: "form-control input-lg", required: true, onchange: "$('.well').show();"
            =# select_tag "purchase_order[vendor]", options_for_select(Rails.cache.fetch("all_vendors"), @vendor.id), prompt: "Choose a vendor", class: "form-control input-lg", required: true
        %div.panel-footer
          %a{href: '#', id: "edit_vendor_link", target: '_blank'}
    %div.purchase_order_input_fields_wrap
      .panel.panel-default{style: "display:block;"}
        .panel-body
          = link_to "Show", '#', onclick: "$(this).next().fadeToggle();", style: "display:none;", class: "toggle_link"
          .row.form-group.calculation_fields
            %div{:class => "col-sm-12 col-md-12"}
              = hidden_field_tag "purchase_order[po_status]", "Open"
              =# label_tag "Item", nil, :class => 'control-label'
              = select_tag "purchase_order[line_items][][item]", options_for_select(Rails.cache.fetch("all_items")), prompt: 'Choose an item' , class: "form-control input-lg item_select", required: true, onchange: "$('#next_button').show();"
              =# select_tag "purchase_order[line_items][][item]", options_for_select(@items.map{ |item| ["#{item.name} (#{item.description})", item.id]}), prompt: 'Choose an item' , class: "form-control input-lg item_select", required: true, onchange: "$('#next_button').show();"#, onchange: "this.form.submit();"
              =# select_tag "purchase_order[line_items][][item]", options_from_collection_for_select(@items, "id", "name"), prompt: 'Choose an item' , class: "form-control input-lg item_select", required: true
              =# select_tag "purchase_order[line_items][][item]", options_for_select(@items.map{ |item| [item.name, item.id, { data: {description: "#{@item_service.fetch_by_id(item.id).description}", rate: "#{@item_service.fetch_by_id(item.id).purchase_cost}"} }] }), prompt: 'Choose an item' , class: "form-control input-lg item_select", required: true
              =# select_tag "purchase_order[line_items][][item]", options_from_collection_for_select(@items, "id", "name"), prompt: 'Choose an item' , class: "form-control input-lg item_select", required: true
              =# label_tag "Description", nil, :class => 'control-label'
              =# text_field_tag "purchase_order[line_items][][description]", nil, :placeholder => "Description", class: "form-control input-lg", readonly: true
              =# label_tag "Gross", nil, :class => 'control-label'
              = hidden_field_tag "purchase_order[line_items][][gross]", nil, :placeholder => "Gross", class: "form-control input-lg amount-calculation-field"
              =# label_tag "Tare", nil, :class => 'control-label'
              = hidden_field_tag "purchase_order[line_items][][tare]", nil, :placeholder => "Tare", class: "form-control input-lg amount-calculation-field"
              =# label_tag "Load", nil, :class => 'control-label'
              = hidden_field_tag "purchase_order[line_items][][quantity]", nil, :placeholder => "Load", class: "form-control input-lg amount-calculation-field", readonly: true
              =# label_tag "Rate", nil, :class => 'control-label'
              = hidden_field_tag "purchase_order[line_items][][rate]", nil, :placeholder => "Rate", class: "form-control input-lg amount-calculation-field"
              =# label_tag "Amount", nil, :class => 'control-label'
              = hidden_field_tag "purchase_order[line_items][][amount]", nil, :placeholder => "Amount", class: "form-control input-lg", required: true
    -#
      .col-sm-6.col-md-4.col-md-offset-4
      %p.pull-right= image_tag("ajax-loader.gif", :id => "spinner", :alt => "Loading ...", style: "display:none;")
      %p= link_to 'More items', line_item_fields_purchase_orders_path, remote: true, id: "add_item_button", class: "btn btn-warning pull-right add_field", onclick: "$(this).hide(); $('#spinner').show();"
      %br
      %br
      %br
      %br
    .row.form-group
      %div{:class => "col-sm-12 col-md-12"}
        -#
          = link_to "Cancel", "javascript:history.back()", :class => "btn btn-lg btn-default btn-block"
        = button_tag(style: 'display:none;', id: 'next_button', :type => 'submit', :class => 'btn btn-primary btn-lg btn-block', data: {disable_with: "<i class='fa fa-spinner fa-spin'></i> Next"}, autocomplete: "off") do
          Next
= render partial: "shared/new_purchase_order_footer_navbar", locals: {title: "Purchase Order"}